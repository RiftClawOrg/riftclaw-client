<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src https://fonts.gstatic.com; connect-src 'self' wss://relay.riftclaw.com https://rift.riftclaw.com;">
  <title>RiftWalker</title>
  <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles/main.css">
</head>
<body>
  <!-- Loading Overlay -->
  <div id="loading-overlay" class="loading-overlay hidden">
    <div class="loading-content">
      <div class="loading-spinner"></div>
      <h2 id="loading-text">Traveling...</h2>
      <p id="loading-subtext">Establishing connection to relay</p>
    </div>
  </div>

  <!-- Toast Container -->
  <div id="toast-container" class="toast-container"></div>

  <!-- Top Bar -->
  <div class="top-bar">
    <div class="top-left">
      <span class="logo">üåÄü¶û RiftClaw: RiftWalker Client</span>
      <span id="connection-status" class="status disconnected">‚óè</span>
    </div>
    <div class="top-center">
      <span id="current-world">Limbo</span>
      <span id="world-type" class="world-type local">Local</span>
    </div>
    <div class="top-right">
      <button id="btn-inventory" class="btn-icon" title="Inventory (I)">üéí</button>
      <button id="btn-passport" class="btn-icon" title="Passport (P)">ID</button>
      <button id="btn-home" class="btn-icon" title="Go to The Rift (G)">üè†</button>
      <button id="btn-help" class="btn-icon" title="Help (H)">‚ùì</button>
      <button id="btn-settings" class="btn-icon" title="Settings (,)">‚öôÔ∏è</button>
    </div>
  </div>

  <!-- Main Content Area -->
  <div class="main-content">
    <!-- Limbo World (Local Three.js) -->
    <div id="limbo-container" class="world-container active">
      <!-- Limbo rendered locally by LimboWorldRenderer -->
    </div>

    <!-- External World (Webview) -->
    <div id="external-container" class="world-container">
      <webview id="world-webview" 
               sandbox="allow-scripts allow-same-origin"
               nodeintegration="false"
               contextisolation="true"
               disablewebsecurity="false"
               allowpopups="false">
      </webview>
    </div>
  </div>

  <!-- Inventory Overlay -->
  <div id="inventory-overlay" class="inventory-overlay hidden">
    <div class="inventory-panel">
      <div class="inventory-header">
        <h3>Inventory</h3>
        <button id="btn-close-inventory" class="btn-close">√ó</button>
      </div>
      <div id="inventory-grid" class="inventory-grid">
        <!-- Slots populated by JS -->
      </div>
      <div class="inventory-footer">
        <span id="inventory-count">0 / 64 slots</span>
      </div>
    </div>
  </div>

  <!-- Passport Overlay -->
  <div id="passport-overlay" class="passport-overlay hidden">
    <div class="passport-card">
      <div class="passport-header">
        <h3>ID RiftWalker Passport</h3>
        <button id="btn-close-passport" class="btn-close">√ó</button>
      </div>
      <div class="passport-body">
        <div class="passport-field">
          <label>Name</label>
          <span id="passport-name">Traveler</span>
        </div>
        <div class="passport-field">
          <label>ID</label>
          <span id="passport-id" class="monospace">...</span>
        </div>
        <div class="passport-field">
          <label>Home World</label>
          <span id="passport-home">The Rift</span>
        </div>
        <div class="passport-field">
          <label>Reputation</label>
          <span id="passport-reputation">0.0</span>
        </div>
        <div class="passport-field">
          <label>Level</label>
          <span id="passport-level">1 (Novice)</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Help Overlay -->
  <div id="help-overlay" class="help-overlay hidden">
    <div class="help-panel">
      <div class="help-header">
        <h3>‚å®Ô∏è Controls & Help</h3>
        <button id="btn-close-help" class="btn-close">√ó</button>
      </div>
      <div class="help-body">
        <div class="help-section">
          <h4>Movement (3rd Person)</h4>
          <div class="help-item">
            <kbd>W</kbd><kbd>A</kbd><kbd>S</kbd><kbd>D</kbd>
            <span>Move around</span>
          </div>
          <div class="help-item">
            <kbd>Space</kbd>
            <span>Jump</span>
          </div>
          <div class="help-item">
            <kbd>Mouse</kbd>
            <span>Look around (click and drag)</span>
          </div>
        </div>

        <div class="help-section">
          <h4>Menus</h4>
          <div class="help-item">
            <kbd>I</kbd>
            <span>Toggle Inventory</span>
          </div>
          <div class="help-item">
            <kbd>P</kbd>
            <span>Toggle Passport</span>
          </div>
          <div class="help-item">
            <kbd>,</kbd>
            <span>Toggle Settings</span>
          </div>
          <div class="help-item">
            <kbd>H</kbd>
            <span>Show this Help</span>
          </div>
        </div>

        <div class="help-section">
          <h4>Travel</h4>
          <div class="help-item">
            <kbd>H</kbd>
            <span>Go to The Rift (home)</span>
          </div>
          <div class="help-item">
            <kbd>O</kbd>
            <span>Return to Limbo</span>
          </div>
          <div class="help-item">
            <span>Click Portal</span>
            <span>Travel to that world</span>
          </div>
        </div>

        <div class="help-section">
          <h4>Chat</h4>
          <div class="help-item">
            <kbd>Enter</kbd>
            <span>Focus chat input</span>
          </div>
          <div class="help-item">
            <kbd>Esc</kbd>
            <span>Close overlays / unfocus chat</span>
          </div>
        </div>

        <div class="help-section">
          <h4>Tips</h4>
          <ul class="help-tips">
            <li>üí° Click in the 3D world before using WASD</li>
            <li>üí° Your inventory syncs between worlds</li>
            <li>üí° Reputation unlocks new portals</li>
            <li>üí° Press Esc to close any menu</li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <!-- Settings Overlay -->
  <div id="settings-overlay" class="settings-overlay hidden">
    <div class="settings-panel">
      <div class="settings-header">
        <h3>‚öôÔ∏è Settings</h3>
        <button id="btn-close-settings" class="btn-close">√ó</button>
      </div>
      <div class="settings-body">
        <div class="settings-section">
          <h4>Connection</h4>
          <div class="setting-row">
            <label>Relay URL</label>
            <input type="text" id="setting-relay-url" value="wss://relay.riftclaw.com">
          </div>
        </div>
        
        <div class="settings-section">
          <h4>Audio</h4>
          <div class="setting-row">
            <label>Master Volume</label>
            <input type="range" id="setting-volume" min="0" max="100" value="80">
            <span id="volume-value">80%</span>
          </div>
          <div class="setting-row">
            <label>
              <input type="checkbox" id="setting-mute" checked>
              Mute on startup
            </label>
          </div>
        </div>
        
        <div class="settings-section">
          <h4>World Bookmarks</h4>
          <div id="bookmarks-list" class="bookmarks-list">
            <!-- Populated by JS -->
          </div>
          <button id="btn-add-bookmark" class="btn-secondary">+ Add Bookmark</button>
        </div>
        
        <div class="settings-footer">
          <button id="btn-save-settings" class="btn-primary">Save Settings</button>
          <button id="btn-reset-settings" class="btn-secondary">Reset to Defaults</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Chat Panel -->
  <div id="chat-panel" class="chat-panel">
    <div class="chat-messages" id="chat-messages"></div>
    <div class="chat-input-area">
      <input type="text" id="chat-input" placeholder="Press Enter to chat..." maxlength="200">
      <button id="btn-send-chat">‚û§</button>
    </div>
  </div>

  <!-- Scripts -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script src="app/world-mechanics.js"></script>
  <script src="app/limbo-world.js"></script>
  <script src="app/rift-world.js"></script>
  <script src="app/main.js"></script>
</body>
</html>
